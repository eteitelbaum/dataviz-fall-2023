{
  "hash": "ab34cd726851d77ca0dfd093197449f0",
  "result": {
    "markdown": "---\ntitle: \"Choropleth Maps\"\ndate: today\ndate-format: long\nfooter: \"[DataViz 2102 Website](https://dataviz-gwu.rocks)\"\nlogo: images/dataviz-logo.png\nformat:\n  revealjs:\n    theme: [simple, custom.scss]\n    transition: fade\n    slide-number: true\n    multiplex: true\n    chalkboard: true\nexecute:\n  echo: false\n  message: false\n  warning: false\n  freeze: auto\n---\n\n::: {.cell}\n\n:::\n\n\n## Choropleth Map\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](week-7.1_files/figure-revealjs/flfp_map-1.png){width=960}\n:::\n:::\n\n\n## Simple Features\n\n![](images/simple_feature_dataframe.png){fig-align=center}\n\n\n## Mercator Projection\n\n![*Source:* Wikipedia](images/mercator.jpg){fig-align=center}\n\n## Natural Earth Projection\n\n![*Source:* Wikipedia](images/natural_earth.jpg)\n\n## Disputed Territory\n\n![*Source:* Wikimedia Commons](images/kashmir.png)\n\n## Development\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](week-7.1_files/figure-revealjs/gdp_map-1.png){width=960}\n:::\n:::\n\n\n## Map Code\n\n<br> \n\nGrab country shapes with `ne_countries()`\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rnaturalearth)\nlibrary(dplyr)\n\nworld_map_df <- ne_countries(scale = \"medium\", returnclass = \"sf\") |>\n    filter(name != \"Antarctica\") # remove Antarctica\n\n#world_map_df |>\n#glimpse()\n\n# view contents of geometry column\nworld_map_df |>\n  select(geometry) \n```\n:::\n\n\n## Map Code\n\n<br>\n\nMake a map using `geom_sf()` from `ggplot2`.\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nggplot(data = world_map_df) +\n  geom_sf(aes(fill = income_grp)) + \n  labs(title = \"World Bank country income categories\")\n```\n:::\n\n\n## Map Code\n\n<br>\n  \nAdd a color scale and a theme. \n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggthemes)\n\nggplot(data = world_map_df) +\n  geom_sf(aes(fill = income_grp)) + \n  labs(\n    title = \"World Bank country income categories\",\n    fill = \"Category\"\n    ) +\n    scale_fill_viridis_d() +\n    theme_map() \n```\n:::\n\n\n## Your Turn!\n\n<br>\n\n- Make a map of WB income categories\n- Start by grabbing the country shapes\n- Store data frame in an object\n- Use `geom_sf()` to make the map\n- Style the map\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"setup\" data-update-every=\"1\" tabindex=\"0\" style=\"right:10%;bottom:10%;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">05</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n\n\n## Map Other Data\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](week-7.1_files/figure-revealjs/oil_rents1-1.png){width=960}\n:::\n:::\n\n\n## Map Other Data\n\n<br>\n\nGrab data from the WB, join with country shapes...\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(wbstats)\n\noil_rents_df <- wb_data(c(oil_rents_gdp = \"NY.GDP.PETR.RT.ZS\"), mrnev = 1) \n\nrents_map_df <- left_join(world_map_df, oil_rents_df, join_by(iso_a3 == iso3c))\n\nrents_map_df |>\n  select(last_col(5):last_col()) |> #select last 5 columns of df\n  glimpse() \n```\n:::\n\n\n## Map Other Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = rents_map_df) +\n  geom_sf(aes(fill = oil_rents_gdp)) + # shade based on oil rents\n  labs(\n    title = \"Oil rents (% of GDP)\",\n    subtitle = \"(Most recent available data)\", # add subtitle\n    fill = \"Percent\", \n    caption = \"Source: World Bank Development Indicators\"\n    ) +\n  theme_map() +\n  theme(\n    legend.position = \"right\", \n    #legend.title = element_text(size = 8),\n    #legend.text = element_text(size = 6)\n    plot.title = element_text(face = \"bold\"), # move legend\n    ) +\n  scale_fill_viridis_c( # chg from discrete (_d) to continuous (_c)\n      option = \"magma\", #  chg to magma theme\n      labels = scales::label_percent(scale = 1) # add % label for legend\n      ) \n```\n:::\n\n\n## Your Turn! \n\n<br>\n\n- Using the code from module 3.1 as a template...\n- Try mapping a favorite variable from the World Bank\n- First, download the relevant data using `wbstats`\n- Then merge it with your country shapes\n- Map using `geom_sf()`\n- Beautify your map! \n\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"exercise2\" data-update-every=\"1\" tabindex=\"0\" style=\"right:10%;bottom:10%;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">10</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n\n## Map Some V-Dem Data\n\n<br>\n\n- Now try mapping some V-Dem data\n- Remind yourself of how to download data from V-Dem\n- You will have to convert country codes to iso3c\n- Then merge with country shapes\n- Then map your V-Dem indicator!\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"exercise2\" data-update-every=\"1\" tabindex=\"0\" style=\"right:10%;bottom:10%;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">10</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n\n## Coding With AI\n\n<br>\n\n- Sometimes coding with AI can helpful\n- Sometimes not! \n- Try prompting ChatGPT to code up a choropleth map\n- Tell it what packages to use\n- See how it does and note what it does differently relative to humans\n- Then debug the code\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"exercise2\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">10</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n",
    "supporting": [
      "week-7.1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\r\n<script src=\"../site_libs/countdown-0.4.0/countdown.js\"></script>\r\n"
      ],
      "include-after-body": [
        "\r\n<script>\r\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\r\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\r\n  // slide changes (different for each slide format).\r\n  (function () {\r\n    // dispatch for htmlwidgets\r\n    function fireSlideEnter() {\r\n      const event = window.document.createEvent(\"Event\");\r\n      event.initEvent(\"slideenter\", true, true);\r\n      window.document.dispatchEvent(event);\r\n    }\r\n\r\n    function fireSlideChanged(previousSlide, currentSlide) {\r\n      fireSlideEnter();\r\n\r\n      // dispatch for shiny\r\n      if (window.jQuery) {\r\n        if (previousSlide) {\r\n          window.jQuery(previousSlide).trigger(\"hidden\");\r\n        }\r\n        if (currentSlide) {\r\n          window.jQuery(currentSlide).trigger(\"shown\");\r\n        }\r\n      }\r\n    }\r\n\r\n    // hookup for slidy\r\n    if (window.w3c_slidy) {\r\n      window.w3c_slidy.add_observer(function (slide_num) {\r\n        // slide_num starts at position 1\r\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\r\n      });\r\n    }\r\n\r\n  })();\r\n</script>\r\n\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}